<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATIP Scraper Configuration</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f4f7f6; color: #333; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; width: 100%; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9em; color: #555; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; box-sizing: border-box; }
        input:focus, textarea:focus { border-color: #3498db; outline: none; }
        textarea { resize: vertical; min-height: 80px; }
        button { width: 100%; padding: 12px; background: #3498db; color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #2980b9; }
        .message { padding: 15px; background: #d4edda; color: #155724; border-radius: 4px; margin-bottom: 20px; text-align: center; }
        .help { font-size: 0.8em; color: #888; margin-top: 4px; }
        .checkbox-group { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .checkbox-group input { width: auto; margin: 0; }
        .checkbox-group label { margin: 0; font-weight: normal; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ATIP Configuration Editor</h1>
        <% if (message) { %>
        <div class="message"><%= message %></div>
        <% } %>
        <form method="POST" action="/save">
            
            <div class="form-group">
                <label for="url">Target URL</label>
                <input type="url" id="url" name="url" value="<%= data.url || '' %>" required placeholder="https://open.canada.ca/en/search/ati?..." pattern="https://.*">
                <div class="help">The search URL from open.canada.ca (Must start with https://)</div>
            </div>

            <div class="form-group">
                <label for="requestor_category">Requestor Category</label>
                <select id="requestor_category" name="requestor_category">
                    <option value="Member of the Public" <%= data.requestor_category === 'Member of the Public' ? 'selected' : '' %>>Member of the Public</option>
                    <option value="Media" <%= data.requestor_category === 'Media' ? 'selected' : '' %>>Media</option>
                    <option value="Academia" <%= data.requestor_category === 'Academia' ? 'selected' : '' %>>Academia</option>
                    <option value="Business" <%= data.requestor_category === 'Business' ? 'selected' : '' %>>Business</option>
                    <option value="Organization" <%= data.requestor_category === 'Organization' ? 'selected' : '' %>>Organization</option>
                </select>
            </div>

            <div class="form-group">
                <label for="delivery_method">Delivery Method</label>
                <select id="delivery_method" name="delivery_method">
                    <option value="Electronic Copy" <%= data.delivery_method === 'Electronic Copy' ? 'selected' : '' %>>Electronic Copy</option>
                    <option value="Paper Copy" <%= data.delivery_method === 'Paper Copy' ? 'selected' : '' %>>Paper Copy</option>
                </select>
            </div>

            <div style="display: flex; gap: 20px;">
                <div class="form-group" style="flex: 1;">
                    <label for="given_name">Given Name</label>
                    <input type="text" id="given_name" name="given_name" value="<%= data.given_name || '' %>">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="family_name">Family Name</label>
                    <input type="text" id="family_name" name="family_name" value="<%= data.family_name || '' %>">
                </div>
            </div>

            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" value="<%= data.email || '' %>">
            </div>

            <div class="form-group">
                <label for="phone">Telephone Number</label>
                <input type="tel" id="phone" name="phone" value="<%= data.phone || '' %>">
            </div>

            <div class="form-group">
                <label for="address">Mailing Address</label>
                <input type="text" id="address" name="address" value="<%= data.address || '' %>">
            </div>

            <div class="form-group">
                <label for="address_2">Address Line 2 (Optional)</label>
                <input type="text" id="address_2" name="address_2" value="<%= data.address_2 || '' %>">
            </div>

            <div style="display: flex; gap: 20px;">
                <div class="form-group" style="flex: 2;">
                    <label for="city">City</label>
                    <input type="text" id="city" name="city" value="<%= data.city || '' %>">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="postal_code">Postal Code</label>
                    <input type="text" id="postal_code" name="postal_code" value="<%= data.postal_code || '' %>">
                </div>
            </div>

            <div style="display: flex; gap: 20px;">
                <div class="form-group" style="flex: 1;">
                    <label for="state_province">Province</label>
                    <select id="state_province" name="state_province">
                        <option value="" <%= !data.state_province ? 'selected' : '' %>>Select Province</option>
                        <option value="Alberta" <%= data.state_province === 'Alberta' ? 'selected' : '' %>>Alberta</option>
                        <option value="British Columbia" <%= data.state_province === 'British Columbia' ? 'selected' : '' %>>British Columbia</option>
                        <option value="Manitoba" <%= data.state_province === 'Manitoba' ? 'selected' : '' %>>Manitoba</option>
                        <option value="New Brunswick" <%= data.state_province === 'New Brunswick' ? 'selected' : '' %>>New Brunswick</option>
                        <option value="Newfoundland and Labrador" <%= data.state_province === 'Newfoundland and Labrador' ? 'selected' : '' %>>Newfoundland and Labrador</option>
                        <option value="Northwest Territories" <%= data.state_province === 'Northwest Territories' ? 'selected' : '' %>>Northwest Territories</option>
                        <option value="Nova Scotia" <%= data.state_province === 'Nova Scotia' ? 'selected' : '' %>>Nova Scotia</option>
                        <option value="Nunavut" <%= data.state_province === 'Nunavut' ? 'selected' : '' %>>Nunavut</option>
                        <option value="Ontario" <%= data.state_province === 'Ontario' ? 'selected' : '' %>>Ontario</option>
                        <option value="Prince Edward Island" <%= data.state_province === 'Prince Edward Island' ? 'selected' : '' %>>Prince Edward Island</option>
                        <option value="Quebec" <%= data.state_province === 'Quebec' ? 'selected' : '' %>>Quebec</option>
                        <option value="Saskatchewan" <%= data.state_province === 'Saskatchewan' ? 'selected' : '' %>>Saskatchewan</option>
                        <option value="Yukon" <%= data.state_province === 'Yukon' ? 'selected' : '' %>>Yukon</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="country">Country</label>
                    <select id="country" name="country">
                        <option value="Canada" <%= data.country === 'Canada' || !data.country ? 'selected' : '' %>>Canada</option>
                        <option value="United States" <%= data.country === 'United States' ? 'selected' : '' %>>United States</option>
                        <option value="Other" <%= data.country === 'Other' ? 'selected' : '' %>>Other</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="preferred_language">Preferred Language</label>
                 <select id="preferred_language" name="preferred_language">
                    <option value="English" <%= data.preferred_language === 'English' ? 'selected' : '' %>>English</option>
                    <option value="French" <%= data.preferred_language === 'French' ? 'selected' : '' %>>French</option>
                </select>
            </div>
             <div class="form-group">
                <label for="consent">Consent</label>
                 <select id="consent" name="consent">
                    <option value="Yes" <%= data.consent === 'Yes' ? 'selected' : '' %>>Yes</option>
                    <option value="No" <%= data.consent === 'No' ? 'selected' : '' %>>No</option>
                </select>
            </div>

            <div class="form-group">
                <label for="countdown_seconds">Countdown Duration (seconds)</label>
                <input type="number" id="countdown_seconds" name="countdown_seconds" value="<%= data.countdown_seconds || 5 %>" min="1" max="60">
                <div class="help">Time before auto-submit in Live Mode (1-60 seconds, default: 5)</div>
            </div>

            <div class="form-group">
                <label for="additional_comments">Additional Comments</label>
                <textarea id="additional_comments" name="additional_comments"><%= data.additional_comments || '' %></textarea>
            </div>

            <button type="submit">Save Configuration</button>
        </form>
        
        <form method="POST" action="/start" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
             <div class="form-group" style="margin-bottom: 15px;">
                <label style="font-size: 1.1em; margin-bottom: 10px;">Execution Mode:</label>
                <label style="font-weight: normal; margin-bottom: 5px;">
                    <input type="radio" name="mode" value="test" checked> 
                    <strong>Test Mode</strong> (Fills forms only - NO SUBMIT)
                </label>
                <label style="font-weight: normal;">
                    <input type="radio" name="mode" value="live"> 
                    <strong>Live Mode</strong> (Fills AND Submits - REAL ACTION)
                </label>
                <div class="checkbox-group">
                    <input type="checkbox" id="headless" name="headless" value="true">
                    <label for="headless">Run Headless (Invisible Browser)</label>
                </div>
             </div>
             <button type="submit" style="background-color: #27ae60;">Start Scraper</button>
             <div class="help" style="text-align: center;">Opens a new browser window to run the process</div>
        </form>
    </div>
</body>
</html>
